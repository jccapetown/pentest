#!/usr/bin/python
#IP_NSLOOKUP
#Version 1.0
#Author: Geoffrey Chisnall
#2017

import subprocess
from subprocess import Popen, PIPE, STDOUT

iplist = "iplist.txt"
 
ipfile = open(iplist,'rb')
lines = ipfile.readlines()
ipfile.close()

dnsserver=raw_input("Which DNS server would you like to resolve against? => ")

dnsresults = open('ips_resolved.txt','w')
for ip in lines:
    ip = ip.strip()
    nslookup="nslookup %s %s | grep name" % (ip.strip(),dnsserver)
    try:
        nslookupresult = subprocess.check_output(nslookup, shell=True).split("\n")
        for line in nslookupresult:
            if line != '':
                a = line.split()
                if len(a) == 4:
                    print ip,a[3]
                    dnsresults.write("%s %s\n" % (ip.strip(),a[3]))
    except:
        print ip.strip(), "No reverse found"
        dnsresults.write("%s %s\n" % (ip.strip(), "No reverse found"))

dnsresults.close()
