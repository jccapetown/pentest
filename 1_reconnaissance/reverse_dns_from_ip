#!/usr/bin/python
#Author Christiaan Heyns
import sys
import subprocess
import os

formattedanswer = []
script_name = os.path.basename(sys.argv[0])
print script_name
script_savename = "%s.output" % script_name
dns =''
if len(sys.argv) > 1:
		dns = sys.argv[1]

def look_it_up( ip_lookup, dns ):
		global formattedanswer
		#Do system call here:
#		print "Looking...."
		answer = ''
		try:
				if dns == '':
						cmd = "nslookup %s" % ip_lookup
				else:
						cmd = "nslookup %s %s" % (ip_lookup, dns)
				answer = subprocess.check_output(cmd, shell=True)

		except Exception, e:
				#Quiet in here, isn't it?
				#print e.message
				pass
		

		if answer == '':
			 
				formattedanswer.append("%s %s" %(ip_lookup,"No reverse lookup..."))
		else:
				#work with output
				for line in answer.split("\n"):
						if "name" in line:
								i = line
								formattedanswer.append("%s %s" %(".".join(i.split("\t")[0].split(".")[:4][::-1]), i.split("\t")[1].split()[2]))
#								formattedanswer = formattedanswer
#========

#print "Hi, My name is : %s" % sys.argv[0]

if sys.stdin.isatty():
#if len(input_arg) < 1:
		print "You are using TTY to talk to me... :)"
		print "Would you like to read from std input [y/n]?"
		do_this = raw_input()
		if do_this <> '':
				if do_this == 'n':
						print "Bye!"
						sys.exit
				if do_this == 'y':
						ip_lookup = raw_input('Enter IP address to lookup (x.x.x.x) :')
						#run normal mode with std_in:
						#print "%s" % look_it_up(ip_lookup);
						look_it_up(ip_lookup);
						#print formattedanswer
						print "\n".join(formattedanswer)
else:
		#run normal mode with argv input:
		#Check file exists
		#open file
		#loop
#		print "You are sending data through pipe|s to me ....:)"
#		look_it_up("196.34.30.60")
#		print formattedanswer
#		print "\n".join(formattedanswer)
		l_messages = sys.stdin.readlines();
		for line in l_messages:
				if line.strip() == '':
						continue
				#print "looking for '%s'" % line.strip()
				'''	print dns
				print line
				print "======"'''
				look_it_up(line.strip(),dns)

if formattedanswer == []:
		print "No data in results"
else:
		print "\n".join(formattedanswer)
		f = open(script_savename,'w')
		f.write("\n".join(formattedanswer))
		f.close()


